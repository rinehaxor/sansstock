---
interface Stock {
	name: string;
	value: string;
	change: string;
	changeType: 'positive' | 'negative' | 'neutral';
}

interface Props {
	stocks?: Stock[];
}

// Default sample data untuk IHSG stocks - bisa diganti dengan data dari API
const defaultStocks: Stock[] = [
	{ name: 'LABA', value: '199', change: '-9.55%', changeType: 'negative' },
	{ name: 'DFAM', value: '73', change: '0.00%', changeType: 'neutral' },
	{ name: 'NTBK', value: '155', change: '+34.78%', changeType: 'positive' },
	{ name: 'NIRO', value: '280', change: '+0.72%', changeType: 'positive' },
	{ name: 'PJHB', value: '330', change: '-1.23%', changeType: 'negative' },
	{ name: 'BBHI', value: '1,245', change: '+2.45%', changeType: 'positive' },
	{ name: 'BRIS', value: '4,520', change: '-0.84%', changeType: 'negative' },
	{ name: 'BMRI', value: '5,780', change: '+1.12%', changeType: 'positive' },
];

const { stocks = defaultStocks } = Astro.props;
const itemsPerPage = 3;
const totalPages = Math.ceil(stocks.length / itemsPerPage);
---

<div class="w-full">
	<!-- Header -->
	<div class="flex items-center justify-between mb-6">
		<h3 class="text-lg font-semibold text-gray-800">IHSG</h3>
		<div class="flex items-center gap-2 text-gray-600 text-sm">
			<span>Data Powered By</span>
			<span class="font-bold text-black">TradingView</span>
		</div>
	</div>

	<!-- Stock Ticker Container -->
	<div class="relative">
		<!-- Carousel Container -->
		<div 
			class="overflow-hidden"
			id="ihsg-ticker-container"
		>
			<div 
				class="flex transition-transform duration-500 ease-in-out"
				id="ihsg-ticker-slider"
				style={`width: ${totalPages * 100}%`}
			>
				{Array.from({ length: totalPages }).map((_, pageIndex) => {
					const pageWidth = 100 / totalPages;
					return (
						<div class="flex gap-4 px-2 items-stretch" style={`width: ${pageWidth}%`}>
							{stocks.slice(pageIndex * itemsPerPage, (pageIndex + 1) * itemsPerPage).map((stock) => (
								<div class="flex-1 bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-5 shadow-sm border border-blue-200/50 hover:shadow-md transition-shadow flex flex-col min-h-[140px]">
									<!-- Stock Name -->
									<div class="mb-3">
										<h3 class="text-lg font-semibold text-gray-800">{stock.name}</h3>
									</div>
									
									<!-- Stock Value -->
									<div class="mb-3 min-h-[3rem] flex items-center">
										<p class="text-2xl font-bold text-gray-900 truncate">{stock.value}</p>
									</div>
									
									<!-- Change Indicator -->
									<div class="flex items-center gap-1">
										{stock.changeType === 'positive' ? (
											<>
												<svg class="w-4 h-4 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12" />
												</svg>
												<span class="text-sm font-semibold text-green-600">
													{stock.change}
												</span>
											</>
										) : stock.changeType === 'negative' ? (
											<>
												<svg class="w-4 h-4 text-red-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6" />
												</svg>
												<span class="text-sm font-semibold text-red-600">
													{stock.change}
												</span>
											</>
										) : (
											<span class="text-sm font-semibold text-gray-600">
												{stock.change}
											</span>
										)}
									</div>
								</div>
							))}
						</div>
					);
				})}
			</div>
		</div>

		<!-- Pagination Dots -->
		{totalPages > 1 && (
			<div class="flex justify-center gap-2 mt-6">
				{Array.from({ length: totalPages }).map((_, index) => (
					<button
						type="button"
						class={`rounded-full transition-all ${index === 0 ? 'bg-gray-700 w-6' : 'bg-gray-300 w-2'} h-2 hover:bg-gray-400`}
						data-page={index}
						data-ticker="ihsg"
						aria-label={`Go to page ${index + 1}`}
					></button>
				))}
			</div>
		)}
	</div>
</div>

<script define:vars={{ totalPages }}>
	// Carousel functionality for IHSG Ticker
	document.addEventListener('DOMContentLoaded', () => {
		const container = document.getElementById('ihsg-ticker-slider');
		const dots = document.querySelectorAll('[data-ticker="ihsg"]');
		let currentPage = 0;

		if (container && dots.length > 0 && totalPages > 1) {
			// Update slider position
			function updateSlider() {
				if (container) {
					const pageWidth = 100 / totalPages;
					const translateX = -(currentPage * pageWidth);
					container.style.transform = `translateX(${translateX}%)`;
				}
				
				// Update dots
				dots.forEach((dot, index) => {
					if (index === currentPage) {
						dot.classList.remove('bg-gray-300', 'bg-gray-400', 'w-2');
						dot.classList.add('bg-gray-700', 'w-6');
					} else {
						dot.classList.remove('bg-gray-700', 'w-6');
						dot.classList.add('bg-gray-300', 'w-2');
					}
				});
			}

			// Add click handlers to dots
			dots.forEach((dot, index) => {
				dot.addEventListener('click', () => {
					currentPage = index;
					updateSlider();
				});
			});

			// Auto-play carousel (optional)
			setInterval(() => {
				currentPage = (currentPage + 1) % totalPages;
				updateSlider();
			}, 5000); // Change slide every 5 seconds
		}
	});
</script>

<style>
	#ihsg-ticker-slider {
		display: flex;
	}
</style>

