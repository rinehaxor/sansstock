import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.DMVOjPfi.js";import{z as c}from"./index.D6iQpRBa.js";import{C as xe,d as he}from"./Card.DNFj8Mwi.js";import{I as j}from"./Input.BNCvmRV-.js";import{c as Z}from"./utils.CBfrqCZ4.js";import{P as pe,B as o,D as B,a as O,b as $,c as R,d as I,e as Y}from"./dialog.COW6o2uI.js";import{c as ge}from"./index.3rXK4OIH.js";const ee=l.forwardRef(({className:d,...m},u)=>e.jsx("textarea",{className:Z("flex min-h-[80px] w-full rounded-md border border-input bg-white px-3 py-2 text-base ring-offset-background shadow-sm transition-colors placeholder:text-muted-foreground hover:border-input/80 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 disabled:bg-muted md:text-sm",d),ref:u,...m}));ee.displayName="Textarea";var fe="Label",ae=l.forwardRef((d,m)=>e.jsx(pe.label,{...d,ref:m,onMouseDown:u=>{u.target.closest("button, input, select, textarea")||(d.onMouseDown?.(u),!u.defaultPrevented&&u.detail>1&&u.preventDefault())}}));ae.displayName=fe;var se=ae;const je=ge("text-sm font-semibold leading-none text-gray-700 peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),b=l.forwardRef(({className:d,...m},u)=>e.jsx(se,{ref:u,className:Z(je(),d),...m}));b.displayName=se.displayName;function De(){const[d,m]=l.useState([]),[u,M]=l.useState(!0),[y,te]=l.useState(""),[n,g]=l.useState(new Set),[f,H]=l.useState("grid"),[r,E]=l.useState(null),[re,v]=l.useState(!1),[le,N]=l.useState(!1),[w,_]=l.useState(""),[k,z]=l.useState(""),[U,J]=l.useState(!1),[ie,S]=l.useState(!1),[p,G]=l.useState(null),[V,L]=l.useState(""),[C,T]=l.useState(""),[P,K]=l.useState(!1),[q,D]=l.useState(!1);l.useEffect(()=>{Q()},[y]);const Q=async()=>{M(!0);try{const a=new URLSearchParams;y&&a.append("search",y),a.append("limit","100");const s=await fetch(`/api/media?${a.toString()}`,{credentials:"include"});if(s.ok){const t=await s.json();m(t.data||[])}else console.error("Failed to fetch media")}catch(a){console.error("Error fetching media:",a)}finally{M(!1)}},F=a=>{if(a===0)return"0 Bytes";const s=1024,t=["Bytes","KB","MB","GB"],i=Math.floor(Math.log(a)/Math.log(s));return Math.round(a/Math.pow(s,i)*100)/100+" "+t[i]},W=a=>new Date(a).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),X=a=>{const s=String(a),t=new Set(n);t.has(s)?t.delete(s):t.add(s),g(t)},ne=()=>{n.size===d.length?g(new Set):g(new Set(d.map(a=>String(a.id))))},de=a=>{E(a),v(!0),_(a.alt_text||""),z(a.description||"")},oe=async()=>{if(r){J(!0);try{const a=await fetch(`/api/media/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({alt_text:w||null,description:k||null,file_path:r.file_path||null}),credentials:"include"});if(a.ok){const s=await a.json();m(t=>t.map(i=>i.id===r.id?{...i,alt_text:w,description:k}:i)),E({...r,alt_text:w,description:k}),N(!1),alert("Metadata berhasil diperbarui!")}else{const s=await a.json();alert("Error: "+(s.error||"Gagal memperbarui metadata"))}}catch{alert("Error: Gagal memperbarui metadata")}finally{J(!1)}}},A=a=>{navigator.clipboard.writeText(a),c.success("URL berhasil disalin!")},ce=async()=>{if(!p){c.error("Pilih file terlebih dahulu");return}K(!0);try{const a=new FormData;a.append("file",p),C.trim()&&a.append("alt_text",C.trim());const s=await fetch("/api/upload/thumbnail",{method:"POST",body:a,credentials:"include"});if(s.ok){const t=await s.json();t.path&&m(i=>i.some(x=>x.file_path===t.path)?i.map(x=>x.file_path===t.path?{...x,alt_text:C.trim()||x.alt_text,url:t.url||x.url}:x):i),G(null),L(""),T(""),S(!1),Q(),c.success("Gambar berhasil diupload!")}else{const t=await s.json();c.error(t.error||"Gagal mengupload gambar")}}catch{c.error("Gagal mengupload gambar")}finally{K(!1)}},me=async a=>{if(confirm("Apakah Anda yakin ingin menghapus gambar ini?")){D(!0);try{const s=await fetch(`/api/media/${a}`,{method:"DELETE",credentials:"include"});if(s.ok)m(t=>t.filter(i=>i.id!==a)),g(t=>{const i=new Set(t);return i.delete(String(a)),i}),r?.id===a&&(v(!1),E(null)),c.success("Gambar berhasil dihapus!");else{const t=await s.json();c.error(t.error||"Gagal menghapus gambar")}}catch{c.error("Gagal menghapus gambar")}finally{D(!1)}}},ue=async()=>{if(n.size===0){c.error("Pilih gambar terlebih dahulu");return}if(confirm(`Apakah Anda yakin ingin menghapus ${n.size} gambar?`)){D(!0);try{const a=Array.from(n).map(h=>fetch(`/api/media/${h}`,{method:"DELETE",credentials:"include"})),t=(await Promise.allSettled(a)).filter(h=>h.status==="fulfilled"&&h.value.ok).length,i=n.size-t;m(h=>h.filter(x=>!n.has(String(x.id)))),g(new Set),i===0?c.success(`${t} gambar berhasil dihapus!`):c.error(`${t} gambar berhasil dihapus, ${i} gagal.`)}catch{c.error("Gagal menghapus gambar")}finally{D(!1)}}};return e.jsx(xe,{children:e.jsxs(he,{className:"p-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(j,{type:"text",placeholder:"Cari media...",value:y,onChange:a=>te(a.target.value),className:"w-full"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"default",size:"sm",onClick:()=>S(!0),children:"Upload Gambar"}),n.size>0&&e.jsxs(o,{variant:"destructive",size:"sm",onClick:ue,disabled:q,children:["Hapus (",n.size,")"]}),e.jsx(o,{variant:f==="grid"?"default":"outline",size:"sm",onClick:()=>H("grid"),children:"Grid"}),e.jsx(o,{variant:f==="list"?"default":"outline",size:"sm",onClick:()=>H("list"),children:"List"})]})]}),d.length>0&&e.jsxs("div",{className:"mb-4 flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:n.size===d.length&&d.length>0,onChange:ne,className:"rounded border-input"}),e.jsx("span",{className:"text-sm text-gray-600",children:n.size>0?`${n.size} item dipilih`:"Pilih semua"})]}),u?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Memuat media..."})}):d.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("svg",{className:"w-16 h-16 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),e.jsx("p",{className:"text-gray-500 text-lg",children:"Belum ada media"}),e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:"Upload gambar pertama Anda melalui form artikel"})]}):e.jsx("div",{className:f==="grid"?"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-4":"space-y-2",children:d.map(a=>e.jsx("div",{className:`relative group cursor-pointer border-2 rounded-lg overflow-hidden transition-all ${n.has(String(a.id))?"border-blue-500 ring-2 ring-blue-200":"border-gray-200 hover:border-blue-300"} ${f==="list"?"flex items-center gap-4 p-3":""}`,onClick:()=>de(a),children:f==="grid"?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"absolute top-2 left-2 z-10",onClick:s=>{s.stopPropagation(),X(a.id)},children:e.jsx("input",{type:"checkbox",checked:n.has(String(a.id)),onChange:()=>{},className:"rounded border-input w-5 h-5 cursor-pointer"})}),e.jsx("div",{className:"aspect-square bg-gray-100 overflow-hidden",children:e.jsx("img",{src:a.url,alt:a.name,className:"w-full h-full object-cover group-hover:scale-105 transition-transform",onError:s=>{s.target.style.display="none"}})}),e.jsxs("div",{className:"p-2 bg-white",children:[e.jsx("p",{className:"text-xs text-gray-700 truncate",title:a.name,children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:F(a.size)})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"checkbox",checked:n.has(String(a.id)),onChange:s=>{s.stopPropagation(),X(a.id)},className:"rounded border-input"}),e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded overflow-hidden flex-shrink-0",children:e.jsx("img",{src:a.url,alt:a.name,className:"w-full h-full object-cover",onError:s=>{s.target.style.display="none"}})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[F(a.size)," â€¢ ",W(a.created_at)]})]})]})},a.id))}),e.jsx(B,{open:re,onOpenChange:v,children:e.jsxs(O,{className:"max-w-4xl",children:[e.jsxs($,{children:[e.jsx(R,{children:r?.name}),e.jsx(I,{children:"Detail Media"})]}),r&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"relative w-full bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:r.url,alt:r.name,className:"w-full h-auto max-h-96 object-contain mx-auto"})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Ukuran File"}),e.jsx("p",{className:"text-gray-600",children:F(r.size)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:"Tanggal Upload"}),e.jsx("p",{className:"text-gray-600",children:W(r.created_at)})]})]}),e.jsxs("div",{className:"space-y-3 pt-2 border-t",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-gray-700 mb-1",children:["Alt Text ",e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:"(untuk aksesibilitas & SEO)"})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:r.alt_text||e.jsx("span",{className:"text-gray-400 italic",children:"Belum diatur"})})]}),r.description&&e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"Deskripsi"}),e.jsx("p",{className:"text-gray-600 text-sm",children:r.description})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700 mb-2",children:"URL"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"text",value:r.url,readOnly:!0,className:"flex-1 font-mono text-xs"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>A(r.url),children:"Salin"})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{N(!0)},children:"Edit Metadata"}),e.jsx(o,{variant:"destructive",onClick:()=>{r&&me(r.id)},disabled:q,children:"Hapus"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{A(r.url)},children:"Salin URL"}),e.jsx(o,{onClick:()=>{A(r.url),typeof window<"u"&&window.dispatchEvent(new CustomEvent("mediaLibrarySelect",{detail:{url:r.url}})),v(!1)},children:"Gunakan Gambar"})]})]})]})]})}),e.jsx(B,{open:le,onOpenChange:N,children:e.jsxs(O,{children:[e.jsxs($,{children:[e.jsx(R,{children:"Edit Metadata"}),e.jsx(I,{children:"Tambahkan atau edit alt text dan deskripsi untuk gambar ini"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{htmlFor:"edit_alt_text",children:["Alt Text ",e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:"(untuk aksesibilitas & SEO)"})]}),e.jsx(j,{id:"edit_alt_text",type:"text",value:w,onChange:a=>_(a.target.value),placeholder:"Contoh: Grafik pertumbuhan IHSG bulan November 2024",className:"text-sm"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Jelaskan apa yang ada di gambar untuk screen reader dan SEO"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"edit_description",children:"Deskripsi (Opsional)"}),e.jsx(ee,{id:"edit_description",value:k,onChange:a=>z(a.target.value),placeholder:"Deskripsi tambahan tentang gambar ini",rows:3,className:"text-sm"})]})]}),e.jsxs(Y,{children:[e.jsx(o,{variant:"outline",onClick:()=>{N(!1),_(r?.alt_text||""),z(r?.description||"")},disabled:U,children:"Batal"}),e.jsx(o,{onClick:oe,disabled:U,children:U?"Menyimpan...":"Simpan"})]})]})}),e.jsx(B,{open:ie,onOpenChange:S,children:e.jsxs(O,{children:[e.jsxs($,{children:[e.jsx(R,{children:"Upload Gambar"}),e.jsx(I,{children:"Upload gambar baru ke media library"})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"upload_file",children:"Pilih File Gambar"}),e.jsx(j,{id:"upload_file",type:"file",accept:"image/*",onChange:a=>{const s=a.target.files?.[0];if(s){G(s);const t=new FileReader;t.onloadend=()=>{L(t.result)},t.readAsDataURL(s)}},className:"mt-2 cursor-pointer"}),V&&e.jsxs("div",{className:"mt-3",children:[e.jsx("img",{src:V,alt:"Preview",className:"max-w-full h-40 object-contain border border-gray-200 rounded-lg"}),p&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["File: ",p.name," (",(p.size/1024).toFixed(2)," KB)"]})]})]}),e.jsxs("div",{children:[e.jsxs(b,{htmlFor:"upload_alt_text",children:["Deskripsi Gambar (Alt Text) ",e.jsx("span",{className:"text-xs text-gray-500 font-normal",children:"(Opsional)"})]}),e.jsx(j,{id:"upload_alt_text",type:"text",value:C,onChange:a=>T(a.target.value),placeholder:"Contoh: Grafik pertumbuhan ekonomi Q4 2024",className:"mt-2 text-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Jelaskan gambar untuk aksesibilitas dan SEO"})]})]}),e.jsxs(Y,{children:[e.jsx(o,{variant:"outline",onClick:()=>{S(!1),G(null),L(""),T("")},disabled:P,children:"Batal"}),e.jsx(o,{onClick:ce,disabled:P||!p,children:P?"Mengupload...":"Upload"})]})]})})]})})}export{b as L,De as M,ee as T};
