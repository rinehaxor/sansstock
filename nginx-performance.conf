# Nginx Configuration untuk Optimasi Performa
# Tambahkan bagian ini ke dalam server block di /etc/nginx/sites-available/sansstocks

# Cache headers untuk static assets
location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg|webp|woff|woff2|ttf|eot)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
    access_log off;
}

# Cache untuk images dari Astro _image endpoint (optimized images)
location ~* /_image {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    access_log off;
}

# Cache untuk image proxy endpoint
location ~* /api/image-proxy {
    expires 1y;
    add_header Cache-Control "public, max-age=31536000, immutable";
    access_log off;
}

# Gzip compression
gzip on;
gzip_vary on;
gzip_min_length 1024;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/rss+xml
    font/truetype
    font/opentype
    application/vnd.ms-fontobject
    image/svg+xml;

# Brotli compression (jika tersedia)
# brotli on;
# brotli_comp_level 6;
# brotli_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

# Security headers
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-XSS-Protection "1; mode=block" always;

# Preload critical resources (optional, bisa ditambahkan di HTML juga)
# add_header Link "</_astro/_slug_.css>; rel=preload; as=style" always;
# add_header Link "</_astro/client.js>; rel=preload; as=script" always;

