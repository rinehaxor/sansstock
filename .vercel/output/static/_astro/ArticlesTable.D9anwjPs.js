import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as h}from"./index.DMVOjPfi.js";import{D as P}from"./DataTable.BW11Mfvz.js";import{B as k}from"./Badge.BMvICgvW.js";import{D as _,a as C,b as I,c as M,d as T,e as H,B as w}from"./dialog.COW6o2uI.js";import{S as D,a as N,b as E,c as $,d as j}from"./select.yrX-JjFn.js";import{z as L}from"./index.D6iQpRBa.js";import"./utils.CBfrqCZ4.js";import"./Input.BNCvmRV-.js";import"./index.3rXK4OIH.js";import"./index.1ixxEbKp.js";function G({open:r,onOpenChange:s,article:a,categories:g,onSuccess:m}){const[x,n]=h.useState(a.status),[i,b]=h.useState(a.category_id),[p,y]=h.useState(!1);h.useEffect(()=>{r&&(n(a.status),b(a.category_id))},[r,a]);const u=async o=>{o.preventDefault(),y(!0);try{const c={};if(x!==a.status&&(c.status=x,x==="published"&&a.status!=="published"&&(c.published_at=new Date().toISOString())),i!==a.category_id&&(c.category_id=i),Object.keys(c).length===0){s(!1);return}const f=await fetch(`/api/articles/${a.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(c)});if(!f.ok){const v=await f.json();throw new Error(v.error||"Gagal mengupdate artikel")}const S=await f.json();L.success("Artikel berhasil diupdate"),m(),s(!1)}catch(c){console.error("Error updating article:",c),L.error(c instanceof Error?c.message:"Gagal mengupdate artikel")}finally{y(!1)}};return e.jsx(_,{open:r,onOpenChange:s,children:e.jsx(C,{className:"sm:max-w-[425px]",children:e.jsxs("form",{onSubmit:u,children:[e.jsxs(I,{children:[e.jsx(M,{children:"Quick Edit"}),e.jsxs(T,{children:["Edit cepat untuk artikel: ",e.jsx("strong",{children:a.title})]})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"status",className:"text-sm font-medium",children:"Status"}),e.jsxs(D,{value:x,onValueChange:n,children:[e.jsx(N,{id:"status",children:e.jsx(E,{placeholder:"Pilih status"})}),e.jsxs($,{children:[e.jsx(j,{value:"draft",children:"Draft"}),e.jsx(j,{value:"published",children:"Published"}),e.jsx(j,{value:"archived",children:"Archived"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"category",className:"text-sm font-medium",children:"Kategori"}),e.jsxs(D,{value:i?.toString()||"",onValueChange:o=>b(o?parseInt(o):void 0),children:[e.jsx(N,{id:"category",children:e.jsx(E,{placeholder:"Pilih kategori"})}),e.jsx($,{children:g.map(o=>e.jsx(j,{value:o.id.toString(),children:o.name},o.id))})]})]})]}),e.jsxs(H,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>s(!1),disabled:p,children:"Batal"}),e.jsx(w,{type:"submit",disabled:p,children:p?"Menyimpan...":"Simpan"})]})]})})})}async function V(r){if(confirm("Apakah Anda yakin ingin menghapus artikel ini?"))try{const s=await fetch(`/api/articles/${r}`,{method:"DELETE",credentials:"include"});if(s.ok)alert("Artikel berhasil dihapus"),window.location.reload();else{const a=await s.json();alert("Error: "+(a.error||"Gagal menghapus artikel"))}}catch{alert("Error: Gagal menghapus artikel")}}async function z(r){if(confirm(`Apakah Anda yakin ingin menghapus ${r.length} artikel yang dipilih?`))try{const s=r.map(m=>fetch(`/api/articles/${m}`,{method:"DELETE",credentials:"include"})),g=(await Promise.all(s)).filter(m=>!m.ok);g.length===0?(alert(`${r.length} artikel berhasil dihapus`),window.location.reload()):alert(`${g.length} dari ${r.length} artikel gagal dihapus`)}catch{alert("Error: Gagal menghapus artikel")}}function F({articles:r,categories:s,currentPage:a,totalPages:g,totalItems:m,itemsPerPage:x,paginationBaseUrl:n,statusFilter:i="all"}){const[b,p]=h.useState(()=>{try{return JSON.parse(r||"[]")}catch{return[]}}),y=h.useMemo(()=>{try{return JSON.parse(s||"[]")}catch{return[]}},[s]),[u,o]=h.useState(null);h.useEffect(()=>{try{const t=JSON.parse(r||"[]");p(t)}catch{}},[r]);const c=[{id:"title",header:"Judul",sortable:!0,cell:t=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"font-semibold text-gray-900",children:t.title}),t.featured&&e.jsx(k,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 text-xs",children:"â­ Featured"})]}),e.jsx("div",{className:"text-sm text-gray-500 font-mono",children:t.slug}),t.summary&&e.jsx("div",{className:"text-xs text-gray-400 mt-1 line-clamp-1",children:t.summary})]})},{id:"category",header:"Kategori",sortable:!0,cell:t=>e.jsx(k,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:t.categories?.name||"-"})},{id:"status",header:"Status",sortable:!0,cell:t=>e.jsx(k,{className:t.status==="published"?"bg-green-100 text-green-800":t.status==="draft"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800",children:t.status})},{id:"views",header:"Views",sortable:!0,cell:t=>e.jsx("div",{className:"text-sm text-gray-600",children:t.views_count!==void 0&&t.views_count!==null?t.views_count.toLocaleString("id-ID"):"0"})},{id:"date",header:"Tanggal",accessorKey:"created_at",sortable:!0,cell:t=>e.jsx("div",{className:"text-sm text-gray-500",children:t.published_at?new Date(t.published_at).toLocaleDateString("id-ID"):new Date(t.created_at).toLocaleDateString("id-ID")})}],f=t=>[{label:"Quick Edit",onClick:()=>{o(t)},icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})},{label:"Edit Full",onClick:()=>{window.location.href=`/dashboard/articles/${t.id}/edit`},icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})},{label:"Delete",onClick:()=>{V(t.id)},icon:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})}],S=async t=>{const l=t.map(d=>d.id);await z(l)},v=t=>{if(n){const l=new URL(window.location.href);t?l.searchParams.set("search",t):l.searchParams.delete("search"),l.searchParams.set("page","1"),i&&i!=="all"?l.searchParams.set("status",i):l.searchParams.delete("status"),window.location.href=l.toString()}},A=(t,l)=>{const d=new URLSearchParams;return i&&i!=="all"&&d.set("status",i),l&&d.set("search",l),d.set("page",t.toString()),`${n}?${d.toString()}`};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("a",{href:n?`${n}?status=all&page=1`:"?status=all&page=1",className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${i==="all"?"border-blue-600 text-blue-600":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:"Semua"}),e.jsx("a",{href:n?`${n}?status=published&page=1`:"?status=published&page=1",className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${i==="published"?"border-green-600 text-green-600":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:"Published"}),e.jsx("a",{href:n?`${n}?status=draft&page=1`:"?status=draft&page=1",className:`px-4 py-2 text-sm font-medium border-b-2 transition-colors ${i==="draft"?"border-yellow-600 text-yellow-600":"border-transparent text-gray-600 hover:text-gray-900 hover:border-gray-300"}`,children:"Draft"})]}),e.jsx(P,{data:b,columns:c,enableSelection:!0,actionMenuItems:f,onMassDelete:S,getRowId:t=>t.id,onSearch:v,searchPlaceholder:"Filter artikel...",emptyMessage:"Belum ada artikel. Buat artikel pertama untuk memulai.",defaultSort:{key:"date",direction:"desc"},currentPage:a,totalPages:g,totalItems:m,itemsPerPage:x,paginationBaseUrl:n,buildPaginationUrl:A}),u&&e.jsx(G,{open:!!u,onOpenChange:t=>{t||o(null)},article:u,categories:y,onSuccess:()=>{u&&fetch(`/api/articles/${u.id}`,{credentials:"include"}).then(t=>t.json()).then(t=>{t.data&&p(l=>l.map(d=>d.id===u.id?{...d,...t.data}:d))}).catch(console.error),o(null)}})]})}export{F as default};
